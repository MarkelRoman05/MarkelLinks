<div class="container">
  <nav class="navbar" [ngClass]="{ scrolled: isScrolled }">
    <div
      class="navbar-container"
      style="
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
      "
    >
      <div style="display: flex; align-items: center">
        <!-- Botón hamburguesa a la izquierda -->
        <button
          class="menu-toggle"
          type="button"
          (click)="isMenuOpen = !isMenuOpen"
          style="
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            margin-right: 1rem;
            display: none;
          "
          [ngStyle]="{ display: isMobile ? 'block' : 'none' }"
          aria-label="Abrir menú"
        >
          <i class="bi bi-list"></i>
        </button>
        <div class="navbar-logo">
          <img
            src="/images/logo.svg"
            alt="Logo"
            class="logo"
            style="
              max-width: 100%;
              height: auto;
              width: auto;
              max-height: 70px;
              object-fit: contain;
            "
          />
        </div>
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-left: 2rem;
          "
        >
          <div class="navbar-title" *ngIf="!isMobile">
            <h1 style="margin: 0"></h1>
          </div>
        </div>
      </div>
      <!-- Menú lateral móvil -->
      <div
        class="navbar-menu"
        [ngClass]="{ 'mobile-menu': isMobile, open: isMenuOpen }"
        [ngStyle]="{
          display: !isMobile ? 'block' : isMenuOpen ? 'block' : 'none',
          position: isMobile ? 'fixed' : 'static',
          top: isMobile ? '0' : 'auto',
          left: isMobile ? '0' : 'auto',
          height: isMobile ? '100vh' : 'auto',
          width: isMobile ? '70vw' : 'auto',
          background: isMobile ? '#222' : 'none',
          zIndex: isMobile ? 9999 : 'auto',
          boxShadow:
            isMobile && isMenuOpen ? '2px 0 12px rgba(0,0,0,0.4)' : 'none',
          padding: isMobile ? '2rem 1.5rem' : '0',
          transition: isMobile ? 'transform 0.3s ease' : 'none',
          transform:
            isMobile && !isMenuOpen ? 'translateX(-100%)' : 'translateX(0)'
        }"
      >
        <!-- Botón cerrar solo en móvil -->
        <button
          *ngIf="isMobile"
          (click)="isMenuOpen = false"
          style="
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            position: absolute;
            top: 1rem;
            right: 1rem;
          "
          aria-label="Cerrar menú"
        >
          <i class="bi bi-x-lg"></i>
        </button>
        <ul
          style="
            list-style: none;
            display: flex;
            gap: 4.5rem;
            margin: 0;
            padding: 0;
            justify-content: center;
            align-items: center;
            width: 100%;
          "
          [ngStyle]="{
            flexDirection: isMobile ? 'column' : 'row',
            alignItems: isMobile ? 'flex-start' : 'center',
            marginTop: isMobile ? '3rem' : '0'
          }"
        >
          <li>
            <a
              href="javascript:void(0)"
              (click)="scrollToLinks(); isMenuOpen = false"
              style="
                color: white;
                text-decoration: none;
                font-weight: bold;
                font-size: 1.35rem;
              "
              >Enlaces</a
            >
          </li>
          <li>
            <a
              href="javascript:void(0)"
              (click)="scrollToHowToPlay(); isMenuOpen = false"
              style="
                color: white;
                text-decoration: none;
                font-weight: bold;
                font-size: 1.35rem;
              "
              >Cómo reproducir</a
            >
          </li>
          <li>
            <a
              href="javascript:void(0)"
              (click)="scrollToContact(); isMenuOpen = false"
              style="
                color: white;
                text-decoration: none;
                font-weight: bold;
                font-size: 1.35rem;
              "
              >Contacto</a
            >
          </li>
        </ul>
      </div>
      <!-- Reloj SIEMPRE dentro del navbar-container, a la derecha -->
      <div class="time-clock" style="margin-left: 1.5rem">
        <i class="bi bi-clock"></i>
        <iframe
          src="https://free.timeanddate.com/clock/ia11xfrm/n327/tles4/fn2/fs20/fcfff/tct/pct/ftb/th1"
          frameborder="0"
          width="95"
          height="30"
          allowtransparency="true"
        ></iframe>
      </div>
    </div>
  </nav>

  <p class="last-update">
    Última actualización web:
    <span *ngIf="lastUpdate; else loadingUpdate">
      {{ lastUpdate | date : "dd/MM/yyyy HH:mm" }}h
    </span>
    <ng-template #loadingUpdate>
      <span>Cargando...</span>
    </ng-template>
  </p>

  <div class="scroll-to-links" *ngIf="isMobile">
    <button class="scroll-to-links-button" (click)="scrollToHowToPlay()">
      <i class="bi bi-question-circle-fill" style="font-size: x-large"></i>
      <span>Cómo reproducir enlaces Ace Stream</span>
      <i class="bi bi-arrow-down-short" style="font-size: x-large"></i>
    </button>
  </div>

  <h3 class="agenda-header">AGENDA DEPORTIVA</h3>
  <div class="mini-separator"></div>
  <div class="futbol-tv-agendas">
    <div class="iframe-container">
      <div class="spinner-container" *ngIf="loading[0]">
        <mat-spinner class="light-blue-spinner" diameter="78"></mat-spinner>
        <span class="loading-text">Cargando...</span>
      </div>
      <iframe
        id="ftv_iframe_0"
        name="ftv_iframe_0"
        src="https://widgets.futbolenlatv.com/partidos/competition/la-liga?color=007eff&culture=es-ES"
        width="400"
        height="401"
        frameborder="0"
        scrolling="auto"
        style="margin-bottom: 10px"
        (load)="onIframeLoad(0)"
      ></iframe>
    </div>
    <div class="iframe-container">
      <div class="spinner-container" *ngIf="loading[1]">
        <mat-spinner class="light-blue-spinner" diameter="78"></mat-spinner>
        <span class="loading-text">Cargando...</span>
      </div>
      <iframe
        id="ftv_iframe_1"
        name="ftv_iframe_1"
        src="https://widgets.futbolenlatv.com/partidos/competition/liga-campeones?color=007eff&culture=es-ES"
        width="400"
        height="401"
        frameborder="0"
        scrolling="auto"
        style="margin-bottom: 10px"
        (load)="onIframeLoad(1)"
      ></iframe>
    </div>
    <div class="iframe-container">
      <div class="spinner-container" *ngIf="loading[2]">
        <mat-spinner class="light-blue-spinner" diameter="78"></mat-spinner>
        <span class="loading-text">Cargando...</span>
      </div>
      <iframe
        id="ftv_iframe_2"
        name="ftv_iframe_2"
        src="https://widgets.futbolenlatv.com/partidos/competition/europa-league?color=007eff&culture=es-ES"
        width="400"
        height="401"
        frameborder="0"
        scrolling="auto"
        style="margin-bottom: 10px"
        (load)="onIframeLoad(2)"
      ></iframe>
    </div>
    <div class="iframe-container">
      <div class="spinner-container" *ngIf="loading[3]">
        <mat-spinner class="light-blue-spinner" diameter="78"></mat-spinner>
        <span class="loading-text">Cargando...</span>
      </div>
      <iframe
        id="ftv_iframe_3"
        name="ftv_iframe_3"
        src="https://widgets.futbolenlatv.com/partidos/equipo/athletic-club-de-bilbao?color=007eff&culture=es-ES"
        width="400"
        height="401"
        frameborder="0"
        scrolling="auto"
        style="margin-bottom: 10px"
        (load)="onIframeLoad(3)"
      ></iframe>
    </div>
    <div class="iframe-container">
      <div class="spinner-container" *ngIf="loading[4]">
        <mat-spinner class="light-blue-spinner" diameter="78"></mat-spinner>
        <span class="loading-text">Cargando...</span>
      </div>
      <iframe
        id="ftv_iframe"
        name="ftv_iframe"
        src="https://widgets.futbolenlatv.com/partidos/competition/premier-league?color=007eff&culture=es-ES"
        width="400"
        height="401"
        frameborder="0"
        scrolling="auto"
        style="margin-bottom: 10px"
        (load)="onIframeLoad(4)"
      ></iframe>
    </div>
  </div>

  <div>
    <app-agenda-evento-text></app-agenda-evento-text>
  </div>

  <h4 class="text-enlaces-agenda-completa">
    Para ver la agenda completa, visita la web de&nbsp;
    <a href="https://www.futbolenlatv.es/" class="link-futboltv" target="_blank"
      >Fútbol en la TV
      <span style="vertical-align: middle"
        ><sup><i class="bi bi-box-arrow-in-up-right"></i></sup></span
    ></a>
  </h4>

  <h3 class="header-enlaces" id="enlaces">ENLACES</h3>
  <div class="mini-separator"></div>

  <p class="last-update">
    <i class="bi bi-info-circle-fill" style="margin-right: 2px;"></i>
    Los enlaces se actualizan automáticamente todos los días.
  </p>

  <div class="search-container">
    <form class="search-form">
      <div class="search-field-container">
        <i class="bi bi-search search-icon"></i>
        <input
          type="text"
          class="search-field"
          placeholder="Introduce el canal a buscar..."
          [(ngModel)]="searchTerm"
          (keyup)="filterLinks()"
          name="searchTerm"
        />
        <button
          *ngIf="searchTerm"
          class="delete-search-button"
          matTooltip="Borrar texto de búsqueda"
          matTooltipPosition="below"
          (click)="deleteSearch()"
        >
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
    </form>
  </div>

  <p
    class="channel-counter"
    *ngIf="filteredLinks.length > 0"
    style="
      text-align: center;
      font-size: 17px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 500;
    "
  >
    Mostrando
    <span style="color: #3b82f6">{{ getDisplayedChannels() }}</span> de
    <span>{{ getTotalChannels() }}</span> enlaces
  </p>

  <p class="no-encontrado-text" *ngIf="filteredLinks.length === 0">
    <i class="bi bi-exclamation-triangle-fill"></i>&nbsp; No se encontro ningún
    canal.
  </p>

  <div class="links-container" *ngIf="filteredLinks.length > 0">
    <div *ngFor="let provider of providers" class="provider-section">
      <h4 class="provider-header">
        <img 
          [src]="getProviderImage(provider)" 
          [alt]="provider"
          class="provider-logo"
          style="height: 35px; width: auto; margin-right: 12px; vertical-align: middle; object-fit: contain;"
        />
        {{ provider }}
        <span
          style="
            font-size: 14px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.6);
            margin-left: 8px;
          "
          >({{ groupedLinks[provider].length }})</span
        >
      </h4>
      
      <p *ngIf="provider === 'DAZN FÓRMULA 1'" style="color: #ffc107; font-size: 17px; margin: 10px 0; font-weight: 500; text-align: center;">
        <i class="bi bi-exclamation-triangle-fill" style="margin-right: 5px;"></i>
        Solo funcionan los enlaces a partir de la Opción 9
      </p>
     
      <ul class="provider-links">
        <li class="links" *ngFor="let link of groupedLinks[provider]">
          <a
            href="{{ link.url }}"
            class="acestream-link"
            (click)="
              trackClick(link.title, link.url, $event); isMenuOpen = false
            "
          >
            <img [src]="link.img" class="logo-img" alt="{{ link.title }}" />
            <span>{{ link.title }}</span>
          </a>
          <button
            matTooltip="Copiar enlace"
            class="copy-button"
            (click)="copyLink(link.url, link.title)"
          >
            <i
              class="bi bi-copy"
              style="font-size: 17px; display: block; margin: 0"
            ></i>
          </button>
        </li>
      </ul>
    </div>
  </div>

  <hr style="border: 0; border-top: 1px solid #444; margin: 2rem 0" />

  <div class="otra-web">
    <h3 class="otra-web-titulo">OTRAS WEBS DE ENLACES</h3>
    <p class="otra-web-descripcion">
      En el caso de que el enlace que busques no funcione, puedes probar en
      estas otras webs:
    </p>
    <div class="otra-web-links">
      <a
        href="https://ipfs.io/ipns/elcano.top"
        target="_blank"
        class="otra-web-link"
        style="text-decoration: none"
      >
        <img
          src="https://www.solodev.com/file/97299e37-e2ac-11ec-b9ad-0eaef3759f5f/ipfs-logo-icon-b.png"
          alt="Elcano.top"
          title="Elcano.top"
          width="180"
          height="auto"
          style="
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
          "
        />
        <span
          style="
            display: block;
            margin-top: 8px;
            font-size: 0.9rem;
            color: white;
            text-align: center;
          "
          >elcano.top (Ace Stream)</span
        >
      </a>
      <a
        href="https://www.fctv33.work/es"
        target="_blank"
        class="otra-web-link"
        style="text-decoration: none"
      >
        <img
          src="https://statics1.tcgfs39a2.xyz/img/fc/web_logo_fc.svg"
          alt="FCTV33"
          title="FCTV33"
          width="180"
          height="auto"
          style="
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
          "
        />
        <span
          style="
            display: block;
            margin-top: 8px;
            font-size: 0.9rem;
            color: white;
            text-align: center;
          "
          >No requiere Ace Stream</span
        >
      </a>
    </div>
  </div>

  <div class="how-to-play-container" id="como-reproducir">
    <h3 class="how-to-play-header">CÓMO REPRODUCIR ENLACES ACE STREAM</h3>
    <div class="mini-separator"></div>
    <p class="how-to-play-text">
      Para reproducir los enlaces Ace Stream en tu dispositivo necesitas tener
      instalado Ace Stream Media. Para Windows, puedes descargarlo desde la
      página oficial de Ace Stream, haciendo clic
      <a href="https://www.acestream.org/?page=products" target="_blank">aquí</a
      >. Para Android, puedes descargarlo desde la
      <a
        href="https://play.google.com/store/apps/details?id=org.acestream.node"
        target="_blank"
        >Google Play Store</a
      >.
      <i
        class="bi bi-exclamation-triangle-fill"
        style="color: #ffc107; margin-right: 5px; vertical-align: middle"
      ></i>
      <strong
        >No se puede instalar y reproducir enlaces Ace Stream en dispositivos de
        Apple</strong
      >.
    </p>

    <h4 style="color: white; margin: 0 20px 20px 29px">Móvil Android</h4>
    <p class="how-to-play-text">
      Para reproducir los enlaces en tu móvil Android, una vez instalado Ace
      Stream, puedes abrir el enlace haciendo clic en él directamente, y dándole
      a reproducir en Ace Player. También puedes copiar el enlace, abrir Ace
      Stream manualmente y pegar el enlace en el cuadro de texto de "Introduzca
      aquí el enlace al contenido".
    </p>

    <h4 style="color: white; margin: 0 20px 20px 29px">Windows (PC)</h4>
    <p class="how-to-play-text">
      Una vez instalado Ace Stream en Windows, tienes dos formas de reproducir
      los enlaces: la primera es haciendo clic directamente en el enlace,
      seleccionar Ace Player en la ventana que aparece y esperar al anuncio para
      ver el contenido. La segunda opción es copiar el enlace, abrir Ace Player
      manualmente y pegar el enlace en la opción "Medio"
      <i class="bi bi-arrow-right"></i> "Open Ace Stream Content ID".
      <strong>Nota:</strong> Asegúrate de tener abierto Ace Stream Engine
      (ace_engine / Ace Stream HD), si no, ábrelo tú manualmente desde la ruta
      de instalación de Ace Stream (C:\Users\<i>tuusuario</i>\AppData\Roaming
      \ACEStream\engine y abre ace_engine.exe).
    </p>

    <h4 style="color: white; margin: 0 20px 20px 29px">Android TV</h4>
    <p class="how-to-play-text">
      Si tienes una TV o un dispositivo con Android TV, puedes instalar Ace
      Stream Engine haciendo clic
      <a
        href="https://mega.nz/file/BZ8xgSZQ#nKz_gdIpXSMshloazR42mrA1ZyNO4SMFP9zLUgJwSYc"
        target="_blank"
        >aquí</a
      >
      en tu móvil (iOS o Android). Para instalarlo en tu TV, usa la app "Send
      Files to TV" (<a
        href="https://play.google.com/store/apps/details?id=com.yablio.sendfilestotv"
        target="_blank"
        >enlace para Android</a
      >, en iOS en App Store) para enviar el archivo APK a tu TV e instalarlo
      desde allí utilizando un gestor de archivos como ES File Explorer
      (disponible en Play Store en tu Android TV). Una vez instalado, abre Ace
      Stream Engine y en la parte superior derecha, haz clic en los tres
      puntitos y selecciona "Ajustes". Allí, vete a ajustes del servidor, y en
      "Jugador seleccionado" pon Ace Player.<br /><br />
      Para reproducir los enlaces, desde tu dispositivo móvil, accede a la web
      de Markel Links, copia el enlace que quieras reproducir y, utilizando la
      app Control remoto para Android TV (<a
        href="https://play.google.com/store/apps/details?id=tech.simha.androidtvremote"
        target="_blank"
        >enlace para Android</a
      >, en iOS en App Store), pega el enlace en tu TV. Este enlace lo debes
      pegar en el cuadro que te sale al hacer clic en los tres puntitos de la
      parte superior derecha de Ace Stream en tu TV y seleccionando "Introducir
      la ID de contenido". <br />
      <a
        href="https://mega.nz/folder/AddSwK6J#E5L5EeZqvazk2eJLbtFzZg"
        target="_blank"
        style="font-size: x-large"
        >Guía con fotos para reproducir en Android TV</a
      >
    </p>

    <hr style="border: 0; border-top: 1px solid #444; margin: 2rem 0" />

    <p class="how-to-play-text">
      Para reproducir los enlaces correctamente en tu dispositivo, es
      recomendable cambiar este parámetro en la configuración de Ace Player. En
      la barra de arriba ve a "Herramientas"
      <i class="bi bi-arrow-right"></i> "Preferencias"
      <i class="bi bi-arrow-right"></i> "Vídeo" y en Desentrelazado selecciona
      "Automático" y Modo <i class="bi bi-arrow-right"></i> "Yadif (2x)".
    </p>

    <h3 class="how-to-play-header">ELIMINAR RETARDO DE EMISIÓN</h3>
    <div class="mini-separator"></div>

    <p class="how-to-play-text">
      Para evitar ver el contenido con retraso, es recomendable hacer esto en
      Ace Player cada vez que reproduces un enlace (haz clic en la imagen para
      verla en pestaña nueva):
    </p>

    <div class="popup-image-container">
      <a href="images/retardo_ace_stream.jpg" target="_blank">
        <img
          src="images/retardo_ace_stream.jpg"
          alt="Instrucciones para eliminar retardo"
          class="popup-image"
          title="Haz clic para ver en pestaña nueva"
          style="width: 100%; cursor: pointer"
        />
      </a>
    </div>

    <div
      class="image-popup"
      *ngIf="isImagePopupOpen"
      (click)="closeImagePopup()"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      "
    >
      <img
        [src]="popupImageUrl"
        alt="Popup Image"
        style="max-width: 90%; max-height: 90%"
      />
      <button
        (click)="closeImagePopup()"
        title="Cerrar imagen"
        style="
          position: absolute;
          top: 20px;
          right: 20px;
          background-color: #ff4d4d;
          color: white;
          border: none;
          border-radius: 50%;
          width: 30px;
          height: 30px;
          font-size: 18px;
          font-weight: bold;
          cursor: pointer;
          display: flex;
          justify-content: center;
          align-items: center;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          z-index: 1001;
          transition: background-color 0.3s ease, transform 0.2s ease;
        "
      >
        &times;
      </button>
    </div>
    <p class="how-to-play-text" style="margin-top: 1.1rem">
      Para eliminar el retraso en dispositivos móviles, haz clic en el botón
      "Live" de Ace Player.
    </p>
  </div>

  <div id="contacto" class="contact-form">
    <h3>CONTACTO</h3>
    <div class="mini-separator"></div>
    <p>
      Si tienes alguna duda, sugerencia o lo que quieras, no dudes en
      contactarme.
    </p>
    <form #contactForm="ngForm" (ngSubmit)="sendEmail(contactForm)" novalidate>
      <div>
        <input
          type="text"
          name="name"
          placeholder="Nombre"
          required
          pattern="^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$"
          [(ngModel)]="contact.name"
          #name="ngModel"
        />
        <div *ngIf="name.invalid && name.touched" class="error">
          <span *ngIf="name.errors?.['required']"
            >El nombre es obligatorio.</span
          >
          <span *ngIf="name.errors?.['pattern']">
            El nombre solo puede contener letras.
          </span>
        </div>
      </div>
      <div>
        <input
          type="email"
          name="email"
          placeholder="Email"
          required
          email
          [(ngModel)]="contact.email"
          #email="ngModel"
        />
        <div *ngIf="email.invalid && email.touched" class="error">
          <span *ngIf="email.errors?.['required']"
            >El email es obligatorio.</span
          >
          <span *ngIf="email.errors?.['email']">El email no es válido.</span>
        </div>
      </div>
      <div>
        <textarea
          name="message"
          placeholder="Mensaje"
          required
          minlength="5"
          [(ngModel)]="contact.message"
          #message="ngModel"
          rows="4"
          style="resize: vertical"
        ></textarea>
        <div *ngIf="message.invalid && message.touched" class="error">
          <span *ngIf="message.errors?.['required']"
            >El mensaje es obligatorio.</span
          >
          <span *ngIf="message.errors?.['minlength']">
            El mensaje debe tener al menos 5 caracteres.
          </span>
        </div>
      </div>

      <button type="submit" [disabled]="contactForm.invalid">
        <i class="bi bi-send-fill"></i>
        Enviar
      </button>
    </form>
  </div>

  <div class="footer">
    <span class="footer-text">&copy; {{ currentYear }} Markel Links</span>
    <p class="footer-text">
      Todos los enlaces son obtenidos de fuentes externas.
    </p>
    <button class="scroll-to-top" (click)="scrollToTop()">
      Volver arriba <i class="bi bi-arrow-up arrow-top"></i>
    </button>
  </div>
</div>
